!function(){"use strict";function t(t,n){return{x:t||0,y:n||0}}const n=(t,n)=>(t.x=n.x,t.y=n.y,t),o=(t,n,o)=>(t.x=n,t.y=o,t);let s=0,e=[];var i="214fcfc8c74f8dee.png";function r(t){return t&&"object"==typeof t&&"number"==typeof t.id}class c{constructor(t){this.t=t,this.o=c.hash(this.t),this.s=new Set}i(t){this.s.add(t)}u(t,n){const o=n.map(t=>t.h);this.t.every(t=>o.indexOf(t)>-1)&&!this.s.has(t)&&this.s.add(t)}p(t,n){const o=n.map(t=>t.h);this.t.every(t=>o.indexOf(t)>-1)&&this.s.has(t)&&this.s.delete(t)}static hash(t){return t.slice().sort().join("|")}}const a=new class{constructor(){this.v=1,this.s=new Map,this.m=new Map,this.l=new Set}g(t){const n={id:this.v++};return this.s.set(n,t),this.m.forEach(o=>o.u(n,t)),n}k(t){this.l.add(t)}M(t){return this.l.has(t)}P(){if(0===this.l.size)return;let t=!1;const n=o=>{o&&"object"==typeof o&&!r(o)&&Object.values(o).forEach(o=>{r(o)?(this.k(o),t=!0):n(o)})};this.l.forEach(t=>{if(this.l.delete(t),!this.s.has(t))return;const o=this.s.get(t);o.forEach(t=>{n(t)}),this.s.delete(t),this.m.forEach(n=>n.p(t,o))}),t&&this.P()}select(t){const n=c.hash(t);if(this.m.has(n))return this.m.get(n).s;const o=new c(t);return this.m.set(o.o,o),this.s.forEach((n,s)=>{let e=!0;for(let o=0;o<t.length;o++){const s=t[o];n.find(t=>t.h===s)||(e=!1)}e&&o.i(s)}),o.s}D(t){return this.select(t).values().next().value}data(t,n){const o=this.s.get(t);if(!o)throw new Error(`Entity(${t}) not found!`);const s=o.find(t=>t.h===n);if(!s)throw new Error(`Data(${n}) not found for Entity(${t})!`);return s}F(t){const n=this.D([t]);if(!n)return;return this.data(n,t)}};function u(){return a}function h(t,n,o){const s=o.getContext("2d"),e=window.devicePixelRatio||1;return o.style.width=t+"px",o.style.height=n+"px",o.width=Math.round(t*e),o.height=Math.round(n*e),s.scale(e,e),s.webkitImageSmoothingEnabled=!1,s.msImageSmoothingEnabled=!1,s.mozImageSmoothingEnabled=!1,s.S=!1,{width:t,height:n,T:o,j:s,A:e}}const w=document.querySelector.bind(document),p=w("#r"),f=w("#c"),d=w("#u");if(!p||!f||!d)throw new Error("Could not locate DOM!");function v(){return p}function m(t,n,o){return t.addEventListener(n,o,!1),()=>{t.removeEventListener(n,o,!1)}}const l=["viewport","spring-constraint"],g=(t,n="x")=>{const o=u(),s=o.D(l),e=o.data(s,"viewport"),i=o.data(s,"spring-constraint"),r=o.data(i.$,"mv"),c=r.C.x,a=r.C.y,h=(t+c)/e.I,w=(t+a)/e.O,p=e.H,f="x"===n?p.width*h:p.height*w;return Math.floor(f)},y=t=>t/u().F("viewport").H.width*100;function x(){const n=function(){const t=window.innerWidth<window.innerHeight?window.innerWidth:.6*window.innerHeight,n=window.innerWidth<window.innerHeight?window.innerWidth/.6:window.innerHeight;return{h:"viewport",ratio:.6,width:t,height:n,I:100,O:100/.6,H:h(t,n,f)}}(),o=u(),s=o.D(l);if(s){const t=o.data(s,"spring-constraint");o.k(t.$),o.k(t.R),o.k(s)}const e={h:"mv",C:t(),W:t(),q:t()},i={h:"mv",C:t(),W:t(),q:t()},r=o.g([e]),c={h:"spring-constraint",$:o.g([i]),B:10,R:r,G:0,J:.1,K:.2};v().style.width=n.width+"px";const a=[n,c];o.g(a)}window.addEventListener("resize",x);const k=[{path:i,name:"test"}],M={};async function b(){await Promise.all(k.map(async t=>{const n=await(o=t.path,new Promise((t,n)=>{const s=new Image;s.onload=()=>t(s),s.onerror=n,s.src=o}));var o;M[t.name]={path:t.path,name:t.name,L:n}}))}const P=["drag-state","mv"],D=n=>{const o=n,s=n;return o.targetTouches?t(y(o.targetTouches[0].clientX),y(o.targetTouches[0].clientY)):t(y(s.clientX),y(s.clientY))};function E(t){const n=u();return Array.from(t).filter(t=>!n.M(t))}function F(){}function S(t){u().F("fps").N=t}console.log(i),async function(){await b();const i=u();x(),function(){const o=v();m(o,"touchstart",o=>{let s=D(o);const e=u(),i=e.select(["pointer-target"]);let r=null,c=null;if(i.forEach(t=>{if(r)return;const n=e.data(t,"pointer-target");(function(t,n){return t.x>n.U.x-n.V.x&&t.x<n.U.x+n.V.x&&t.y>n.U.y-n.V.y&&t.y<n.U.y+n.V.y})(s,n.X)&&(r=t,c=n.X.U)}),!r||!c)return;o.preventDefault();const a=[{h:"drag-state",target:r},{h:"mv",C:n(t(),c),W:n(t(),c),q:t()}];e.g(a)}),m(o,"touchmove",t=>{const o=u(),s=E(o.select(P));if(0===s.length)return;t.preventDefault();const e=D(t),i=o.data(s[0],"mv");n(i.C,e),n(i.W,e)}),m(o,"touchend",t=>{const n=u(),o=E(n.select(P));0!==o.length&&(t.preventDefault(),n.data(o[0],"drag-state").target=null,n.k(o[0]))})}();const r=i.g([{h:"mv",C:{x:0,y:0},W:{x:0,y:0},q:{x:10,y:0}},{h:"dc"}]),c=[],a=[];var h,w;a.push((function(t,n){t.select(["mv"]).forEach(s=>{const e=t.data(s,"mv");((t,n)=>{t.C.x+=t.q.x*n*n*.001,t.C.y+=t.q.y*n*n*.001,o(t.q,0,0)})(e,n),(t=>{const n=2*t.C.x-t.W.x,s=2*t.C.y-t.W.y;o(t.W,t.C.x,t.C.y),o(t.C,n,s)})(e)})})),c.push(t=>{const n=t.F("viewport");n.H.j.clearRect(0,0,n.H.T.width,n.H.T.height)}),c.push((function(n,o){const s=M["test"].L;const e=n.F("viewport");!function(t,n,o,s,e,i=e,r=!1){const c=u().F("viewport"),a=g(s.x+n*(o.x-s.x)),h=g(s.y+n*(o.y-s.y)),w=g(e),p=g(i);c.H.j.drawImage(t,0,0,t.width,t.height,r?a-w/2:a,r?h-p/2:h,w,p)}(s,o,t(0,0),t(0,0),e.I,e.O)})),c.push((function(t,n){t.select(["mv","dc"]).forEach(o=>{const s=t.data(o,"mv");console.log("x",s.W.x+(s.C.x-s.W.x)*n),console.log("y",s.W.y+(s.C.y-s.W.y)*n)})})),i.g([{h:"fps",N:60}]),c.push(t=>{const n=t.F("viewport"),o=t.F("fps").N.toFixed(2),s=n.height/44;n.H.j.font=s+"/1.5 monospace";const e=n.H.j.measureText(o).width+1,i=1.5*s-s;n.H.j.fillStyle="rgba(255,255,0,1)",n.H.j.fillText(o,n.width-e,n.height-i)}),h=(t,n)=>{i.k(r),console.log("marked entity for destruction",r)},w=3500,e.push({id:++s,action:h,Y:w,Z:0});const{stop:p}=(({_:t,tt:n,nt:o,update:s,ot:e=10,st:i=(()=>{}),et:r=(()=>{})})=>{const c=window.performance,a=t,u=n,h=c.now.bind(c),w=window.requestAnimationFrame.bind(window);let p=0,f=null,d=h(),v=h(),m=0,l=60;return function t(){const n=h();f=w(t),p+=n-d,d=n;let c=p-a>=0,g=Math.floor(p/u);if(g>=e)return p=0,d=h(),void i();for(;g-- >0;)p-=u,s(u);c&&o(p/a),m+=1,v+1e3<=n&&(l=.25*m+.75*l,m=0,v=n,r(l))}(),{stop:()=>{f&&cancelAnimationFrame(f)}}})({_:1e3/60,tt:1e3/30,update:t=>{((t=1)=>{e.slice().forEach((n,o)=>{n.Z+=t,n.Z>=n.Y&&(e.splice(o,1),n.action(n.Y,n.Z))})})(t),a.forEach(n=>n(i,t)),i.P()},nt:t=>{c.forEach(n=>n(i,t))},st:F,et:S})}()}();